<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Illandril's FoundryVTT Module Stats</title>
  <style>
    html,
    body {
      font-size: 0.875rem;
    }

    #stats {
      display: grid;
      grid-template-columns: repeat(7, max-content);
      grid-gap: 1rem 0.75rem;
      align-items: center;
    }

    #stats>div {
      display: contents;
    }

    #stats>div:first-child {
      font-weight: bold;
    }

    #stats img {
      vertical-align: middle;
    }
  </style>
</head>

<body>
  <div id="stats">
    <div>
      <span>Downloads</span>
      <span>Forge Installs</span>
      <span>Last Updated</span>
      <span>Foundry Version</span>
      <span>Version</span>
      <span>Open Issues</span>
      <span>Name</span>
    </div>
  </div>
  <script>
    const container = document.getElementById("stats");
    const modules = [
      { key: "chat-enhancements" },
      { key: "grid-labels" },
      { key: "hotbar-uses" },
      { key: "inventory-sorter" },
      { key: "npc-quick-actions" },
      { key: "sheet-lockdown-worldbuilding" },
      { key: "sheet5e-lockdown" },
      { key: "third-pact" },
      { key: "token-hud-scale" },
      { key: "token-tooltips" },
      { key: "turn-marker" },
    ];
    const nameParams = `labelColor=520&color=250&style=flat&cacheSeconds=900`;
    const commonParams = `labelColor=520&color=250&style=flat&cacheSeconds=900`;
    const downloadParams = `labelColor=520&color=250&style=flat&cacheSeconds=900`;
    for (let module of modules) {
      const modContainer = document.createElement("div");
      container.appendChild(modContainer);

      const latestDownloadCount = document.createElement("img");
      latestDownloadCount.src = `https://img.shields.io/github/downloads/illandril/FoundryVTT-${module.key}/latest/module.zip?${commonParams}&label=&suffix=x`;
      modContainer.appendChild(latestDownloadCount);

      const forgeInstalls = document.createElement("img");
      forgeInstalls.src = `https://img.shields.io/badge/dynamic/json?${commonParams}&label=&query=package.installs&url=http%3A%2F%2Fforge-vtt.com%2Fapi%2Fbazaar%2Fpackage%2Fillandril-${module.key}&suffix=%25`;
      modContainer.appendChild(forgeInstalls);

      const latestReleaseDate = document.createElement("img");
      latestReleaseDate.src = `https://img.shields.io/badge/dynamic/json?url=https%3A%2F%2Fapi.github.com%2Frepos%2Fillandril%2FFoundryVTT-${module.key}%2Freleases%2Flatest&query=%24.published_at&${commonParams}&label=`;
      modContainer.appendChild(latestReleaseDate);

      const foundryVersion = document.createElement('span')
      modContainer.appendChild(foundryVersion);

      const minVersion = document.createElement("img");
      minVersion.src = `https://img.shields.io/badge/dynamic/json?${commonParams}&label=&query=%24.compatibility.minimum&url=https%3A%2F%2Fgithub.com%2Fillandril%2FFoundryVTT-${module.key}%2Freleases%2Flatest%2Fdownload%2Fmodule.json`;
      foundryVersion.appendChild(minVersion);

      foundryVersion.appendChild(document.createTextNode(' / '));
      const coreVersion = document.createElement("img");
      coreVersion.src = `https://img.shields.io/badge/dynamic/json?${commonParams}&label=&query=%24.compatibility.verified&url=https%3A%2F%2Fgithub.com%2Fillandril%2FFoundryVTT-${module.key}%2Freleases%2Flatest%2Fdownload%2Fmodule.json`;
      foundryVersion.appendChild(coreVersion);

      const latestReleaseVersion = document.createElement("img");
      latestReleaseVersion.src = `https://img.shields.io/github/v/release/illandril/FoundryVTT-${module.key}?${commonParams}&label=`;
      modContainer.appendChild(latestReleaseVersion);

      const issuesLink = document.createElement("a");
      issuesLink.href = `https://github.com/illandril/FoundryVTT-${module.key}/issues`;
      modContainer.appendChild(issuesLink);

      const openIssues = document.createElement("img");
      openIssues.src = `https://img.shields.io/github/issues/illandril/FoundryVTT-${module.key}?${commonParams}&logo=github&label=`;
      issuesLink.appendChild(openIssues);

      const name = document.createElement("img");
      name.src = `https://img.shields.io/badge/dynamic/json?${commonParams}&label=&query=%24.title&url=https%3A%2F%2Fgithub.com%2Fillandril%2FFoundryVTT-${module.key}%2Freleases%2Flatest%2Fdownload%2Fmodule.json`;
      modContainer.appendChild(name);
    }
  </script>
</body>

</html>